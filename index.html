<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Morocco Map - Ports and Provinces</title>
    <!-- Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin:0; padding:0; font-family: Arial, sans-serif; }
        #map { width:100%; height:100vh; }
        #info { 
            position: absolute; 
            top: 10px; 
            left: 50px; 
            background: white; 
            padding: 10px; 
            border-radius: 5px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h3>Morocco Map</h3>
        <p id="status">Loading map data...</p>
        <div id="file-list"></div>
    </div>
    <div id="map"></div>
    
    <script>
        // Initialize map centered on Morocco
        var map = L.map('map').setView([31.7917, -7.0926], 6);
        
        // Add OpenStreetMap base layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);
        
        // Function to load and display any GeoJSON file
        function loadLayer(filename, color, layerName) {
            document.getElementById('status').innerHTML = 'Loading: ' + filename;
            
            fetch(filename)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('File not found: ' + filename);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Loaded:', filename, data);
                    
                    // Create the layer
                    var layer = L.geoJSON(data, {
                        style: function(feature) {
                            return {
                                color: color,
                                weight: 2,
                                fillColor: color,
                                fillOpacity: 0.2,
                                opacity: 0.8
                            };
                        },
                        onEachFeature: function(feature, layer) {
                            // Create popup content from properties
                            if (feature.properties) {
                                var popupContent = '<div style="max-width:250px;">';
                                popupContent += '<b>' + layerName + '</b><br><hr>';
                                for (var key in feature.properties) {
                                    if (feature.properties[key]) {
                                        popupContent += '<b>' + key + ':</b> ' + 
                                                       feature.properties[key] + '<br>';
                                    }
                                }
                                popupContent += '</div>';
                                layer.bindPopup(popupContent);
                            }
                        }
                    }).addTo(map);
                    
                    // Update UI
                    document.getElementById('status').innerHTML = 
                        '✓ Loaded: ' + filename;
                    document.getElementById('file-list').innerHTML += 
                        '<div style="color:green; margin:5px 0;">✓ ' + filename + '</div>';
                    
                    return layer;
                })
                .catch(error => {
                    console.log('Could not load:', filename, error);
                    document.getElementById('file-list').innerHTML += 
                        '<div style="color:orange; margin:5px 0;">✗ ' + filename + ' (not found)</div>';
                });
        }
        
        // AUTOMATIC FILE DISCOVERY
        // Try to load common qgis2web file patterns
        window.onload = function() {
            console.log('Starting automatic file discovery...');
            
            // Common qgis2web output patterns based on your layers.js
            const filesToTry = [
                // Try GeoJSON files first
                './layers/portsports_maroc_coordonnees_qgis_1_9.json',
                './layers/map_10.json',
                './layers/provinces.json',
                './layers/ports.json',
                
                // Try JavaScript data files
                './layers/portsports_maroc_coordonnees_qgis_1_9.js',
                './layers/map_10.js',
                './layers/layers.js',
                
                // Try root-level files
                './data/layers.json',
                './layers/layers.json'
            ];
            
            // Try each file
            let filesFound = 0;
            filesToTry.forEach((file, index) => {
                // Load ports in blue, provinces in green
                const color = file.includes('ports') ? '#3388ff' : 
                             file.includes('map_10') ? '#33aa33' : 
                             file.includes('provinces') ? '#33aa33' : '#888888';
                
                const layerName = file.includes('ports') ? 'Ports' : 
                                file.includes('map_10') ? 'Provinces' : 
                                file.includes('provinces') ? 'Provinces' : 'Layer';
                
                // Load with a slight delay to see progress
                setTimeout(() => {
                    loadLayer(file, color, layerName);
                }, index * 500);
            });
            
            // Final check after 5 seconds
            setTimeout(() => {
                if (filesFound === 0) {
                    document.getElementById('status').innerHTML = 
                        'No data files found automatically. Checking layers folder...';
                    checkLayersFolder();
                }
            }, 5000);
        };
        
        // Function to check what's in the layers folder
        function checkLayersFolder() {
            // Try to fetch directory listing (won't work on GitHub Pages)
            // But we can at least log what we tried
            console.log('These files were tried:');
            console.log('- portsports_maroc_coordonnees_qgis_1_9.json/.js');
            console.log('- map_10.json/.js');
            console.log('- provinces.json');
            console.log('- ports.json');
            
            document.getElementById('status').innerHTML = 
                'Please check your browser Console (F12) for file loading attempts.';
        }
        
        // Add scale and zoom controls
        L.control.scale().addTo(map);
        map.zoomControl.setPosition('topright');
    </script>
</body>
</html>
